
/*************************************************************/
/* C-program for self-organized learning of Kohonen network  */
/*                                                           */
/* The purpose here is to find the representatives of p      */
/* clusters in the pattern space. If you can provide the     */
/* the training samples x, and speicify the number p, you    */
/* can use this program easily                               */
/*                                                           */
/*  1) Number of input : I                                   */
/*  2) Number of neurons: M                                  */
/*  3) Number of training patterns: P                        */
/*                                                           */
/* This program is produced by Qiangfu Zhao.                 */
/* You are free to use it for educational purpose            */
/*************************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#define I 4 // num_features
#define M 3 // num_classes 
#define P 150 // num_samples
#define alpha 0.2
#define n_update 20

double w[M][I];
double x[P][I] = {
{-0.900,1.030,-1.341,-1.311},
{-1.142,-0.125,-1.341,-1.311},
{-1.384,0.337,-1.397,-1.311},
{-1.505,0.106,-1.284,-1.311},
{-1.021,1.261,-1.341,-1.311},
{-0.537,1.953,-1.170,-1.049},
{-1.505,0.799,-1.341,-1.180},
{-1.021,0.799,-1.284,-1.311},
{-1.747,-0.356,-1.341,-1.311},
{-1.142,0.106,-1.284,-1.443},
{-0.537,1.491,-1.284,-1.311},
{-1.263,0.799,-1.227,-1.311},
{-1.263,-0.125,-1.341,-1.443},
{-1.868,-0.125,-1.511,-1.443},
{-0.052,2.184,-1.454,-1.311},
{-0.173,3.107,-1.284,-1.049},
{-0.537,1.953,-1.397,-1.049},
{-0.900,1.030,-1.341,-1.180},
{-0.173,1.722,-1.170,-1.180},
{-0.900,1.722,-1.284,-1.180},
{-0.537,0.799,-1.170,-1.311},
{-0.900,1.491,-1.284,-1.049},
{-1.505,1.261,-1.568,-1.311},
{-0.900,0.568,-1.170,-0.917},
{-1.263,0.799,-1.056,-1.311},
{-1.021,-0.125,-1.227,-1.311},
{-1.021,0.799,-1.227,-1.049},
{-0.779,1.030,-1.284,-1.311},
{-0.779,0.799,-1.341,-1.311},
{-1.384,0.337,-1.227,-1.311},
{-1.263,0.106,-1.227,-1.311},
{-0.537,0.799,-1.284,-1.049},
{-0.779,2.415,-1.284,-1.443},
{-0.416,2.646,-1.341,-1.311},
{-1.142,0.106,-1.284,-1.443},
{-1.021,0.337,-1.454,-1.311},
{-0.416,1.030,-1.397,-1.311},
{-1.142,0.106,-1.284,-1.443},
{-1.747,-0.125,-1.397,-1.311},
{-0.900,0.799,-1.284,-1.311},
{-1.021,1.030,-1.397,-1.180},
{-1.626,-1.741,-1.397,-1.180},
{-1.747,0.337,-1.397,-1.311},
{-1.021,1.030,-1.227,-0.786},
{-0.900,1.722,-1.056,-1.049},
{-1.263,-0.125,-1.341,-1.180},
{-0.900,1.722,-1.227,-1.311},
{-1.505,0.337,-1.341,-1.311},
{-0.658,1.491,-1.284,-1.311},
{-1.021,0.568,-1.341,-1.311},
{1.400,0.337,0.535,0.264},
{0.674,0.337,0.421,0.396},
{1.279,0.106,0.649,0.396},
{-0.416,-1.741,0.137,0.133},
{0.795,-0.586,0.478,0.396},
{-0.173,-0.586,0.421,0.133},
{0.553,0.568,0.535,0.527},
{-1.142,-1.510,-0.261,-0.261},
{0.916,-0.356,0.478,0.133},
{-0.779,-0.817,0.080,0.264},
{-1.021,-2.433,-0.147,-0.261},
{0.069,-0.125,0.251,0.396},
{0.190,-1.972,0.137,-0.261},
{0.311,-0.356,0.535,0.264},
{-0.294,-0.356,-0.090,0.133},
{1.037,0.106,0.364,0.264},
{-0.294,-0.125,0.421,0.396},
{-0.052,-0.817,0.194,-0.261},
{0.432,-1.972,0.421,0.396},
{-0.294,-1.279,0.080,-0.130},
{0.069,0.337,0.592,0.790},
{0.311,-0.586,0.137,0.133},
{0.553,-1.279,0.649,0.396},
{0.311,-0.586,0.535,0.002},
{0.674,-0.356,0.308,0.133},
{0.916,-0.125,0.364,0.264},
{1.158,-0.586,0.592,0.264},
{1.037,-0.125,0.705,0.658},
{0.190,-0.356,0.421,0.396},
{-0.173,-1.048,-0.147,-0.261},
{-0.416,-1.510,0.023,-0.130},
{-0.416,-1.510,-0.033,-0.261},
{-0.052,-0.817,0.080,0.002},
{0.190,-0.817,0.762,0.527},
{-0.537,-0.125,0.421,0.396},
{0.190,0.799,0.421,0.527},
{1.037,0.106,0.535,0.396},
{0.553,-1.741,0.364,0.133},
{-0.294,-0.125,0.194,0.133},
{-0.416,-1.279,0.137,0.133},
{-0.416,-1.048,0.364,0.002},
{0.311,-0.125,0.478,0.264},
{-0.052,-1.048,0.137,0.002},
{-1.021,-1.741,-0.261,-0.261},
{-0.294,-0.817,0.251,0.133},
{-0.173,-0.125,0.251,0.002},
{-0.173,-0.356,0.251,0.133},
{0.432,-0.356,0.308,0.133},
{-0.900,-1.279,-0.431,-0.130},
{-0.173,-0.586,0.194,0.133},
{0.553,0.568,1.274,1.709},
{-0.052,-0.817,0.762,0.921},
{1.521,-0.125,1.217,1.183},
{0.553,-0.356,1.046,0.790},
{0.795,-0.125,1.160,1.315},
{2.126,-0.125,1.615,1.183},
{-1.142,-1.279,0.421,0.658},
{1.763,-0.356,1.444,0.790},
{1.037,-1.279,1.160,0.790},
{1.642,1.261,1.331,1.709},
{0.795,0.337,0.762,1.052},
{0.674,-0.817,0.876,0.921},
{1.158,-0.125,0.990,1.183},
{-0.173,-1.279,0.705,1.052},
{-0.052,-0.586,0.762,1.577},
{0.674,0.337,0.876,1.446},
{0.795,-0.125,0.990,0.790},
{2.247,1.722,1.672,1.315},
{2.247,-1.048,1.785,1.446},
{0.190,-1.972,0.705,0.396},
{1.279,0.337,1.103,1.446},
{-0.294,-0.586,0.649,1.052},
{2.247,-0.586,1.672,1.052},
{0.553,-0.817,0.649,0.790},
{1.037,0.568,1.103,1.183},
{1.642,0.337,1.274,0.790},
{0.432,-0.586,0.592,0.790},
{0.311,-0.125,0.649,0.790},
{0.674,-0.586,1.046,1.183},
{1.642,-0.125,1.160,0.527},
{1.884,-0.586,1.331,0.921},
{2.489,1.722,1.501,1.052},
{0.674,-0.586,1.046,1.315},
{0.553,-0.586,0.762,0.396},
{0.311,-1.048,1.046,0.264},
{2.247,-0.125,1.331,1.446},
{0.553,0.799,1.046,1.577},
{0.674,0.106,0.990,0.790},
{0.190,-0.125,0.592,0.790},
{1.279,0.106,0.933,1.183},
{1.037,0.106,1.046,1.577},
{1.279,0.106,0.762,1.446},
{-0.052,-0.817,0.762,0.921},
{1.158,0.337,1.217,1.446},
{1.037,0.568,1.103,1.709},
{1.037,-0.125,0.819,1.446},
{0.553,-1.279,0.705,0.921},
{0.795,-0.125,0.819,1.052},
{0.432,0.799,0.933,1.446},
{0.069,-0.125,0.762,0.790}
};
double y[M];

/*************************************************************/
/* Print out the result of the q-th iteration                */
/*************************************************************/
void PrintResult(int q)
{
	int m, i;

	printf("\n\n");
	printf("Results in the %d-th iteration: \n", q);
	for (m = 0; m < M; m++)
	{
		for (i = 0; i < I; i++)
			printf("%5f ", w[m][i]);
		printf("\n");
	}
	printf("\n\n");
}

/*************************************************************/
/* The main program                                          */
/*************************************************************/
int main()
{
	int m, m0, i, p, q;
	double norm, s, s0;

	/* Initialization of the connection weights */

	for (m = 0; m < M; m++)
	{
		norm = 0;
		for (i = 0; i < I; i++)
		{
			w[m][i] = (double)(rand() % 10001) / 10000.0 - 0.5;
			norm += w[m][i] * w[m][i];
		}
		norm = sqrt(norm);
		for (i = 0; i < I; i++)
			w[m][i] /= norm;
	}
	PrintResult(0);

	/* Unsupervised learning */

	for (q = 0; q < n_update; q++)
	{
		for (p = 0; p < P; p++)
		{
			s0 = 0;
			for (m = 0; m < M; m++)
			{
				s = 0;
				for (i = 0; i < I; i++)
					s += w[m][i] * x[p][i];
				printf("s = %f\n", s); 
				if (s > s0)
				{
					s0 = s;
					m0 = m;
				}
			}

			for (i = 0; i < I; i++)
				w[m0][i] += alpha * (x[p][i] - w[m0][i]);

			norm = 0;
			for (i = 0; i < I; i++)
				norm += w[m0][i] * w[m0][i];
			norm = sqrt(norm);
			for (i = 0; i < I; i++)
				w[m0][i] /= norm;
		}
		PrintResult(q);
	}

	/* Classify the training patterns */

	for (p = 0; p < P; p++)
	{
		s0 = 0;
		for (m = 0; m < M; m++)
		{
			s = 0;
			for (i = 0; i < I; i++)
				s += w[m][i] * x[p][i];
			if (s > s0)
			{
				s0 = s;
				m0 = m;
			}
		}
		printf("Pattern[%d] belongs to %d-th class\n", p, m0);
	}
}
